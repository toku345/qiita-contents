---
title: ClojureScriptå†…ã‹ã‚‰npmãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™ï¼ˆnpm-depsï¼‰
tags:
  - ClojureScript
  - npm
private: false
updated_at: '2023-08-09T11:47:40+09:00'
id: e104570340ba87a4388b
organization_url_name: null
slide: false
---

# tl;dr

project.clj ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ `:npm-deps` ã¨ `:install true` ã‚’è¿½åŠ ã€‚

ã“ã‚“ãªæ„Ÿã˜ã€‚

```diff
diff --git a/project.clj b/project.clj
index 24f0146..065a9f6 100644
--- a/project.clj
+++ b/project.clj
@@ -25,6 +25,8 @@
                 :output-to "target/js/compiled/hello_aws_cli.js"
                 :output-dir "target/js/compiled/dev"
                 :target :nodejs
+                :npm-deps {:aws-sdk "^2.167.0"}
+                :install-deps true
                 :optimizations :none
                 :source-map-timestamp true}}
              {:id "prod"
```

---

ClojureScript ã‚’æ›¸ãå§‹ã‚ãŸ cljs newbie ãŒãƒãƒã‚‹å¤§ããªè½ã¨ã—ç©´ã€
ãã‚ŒãŒã€Œ**ClojureScript ã‚³ãƒ¼ãƒ‰å†…ã‹ã‚‰ npm ãªã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã³å‡ºã™**ã€ã§ã™ã€‚[^1]

[^1]: ãƒãƒã£ãŸã®ã¯ç§ã ã‘ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒ...ğŸ˜…

ã¡ã‚‡ã£ã¨ã‚°ã‚°ã£ã¦ã¿ãŸã¨ã“ã‚ã€[CLJSJS](https://cljsjs.github.io/)ã‚’ä½¿ã†ã¨ã„ã„ã‚ˆã€œã¨ã‹ã€ãã“ã«ãªã„å ´åˆã¯[è‡ªåŠ›ã§ externs ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ã‚ˆ](https://clojurescript.org/reference/packaging-foreign-deps)ã¨ã‹ã€ã„ã‚ã„ã‚è¦‹ã¤ã‹ã‚‹ã®ã§ã™ãŒã€ã©ã‚Œã‚‚ã†ã¾ãè¡Œã‹ãªã‹ã£ãŸã‚Šè¨­å®šã«æˆ¸æƒ‘ã£ãŸã‚Šã™ã‚‹ã“ã¨ï¼‘é€±é–“...[^2]

[^2]: æœ€æ–°ã®[AWS SDK for javascript](https://github.com/aws/aws-sdk-js)ã¨[Alexa Skill Kit](https://github.com/amzn/alexa-skills-kit-js)ã‚’ä½¿ã„ãŸã‹ã£ãŸã®ã§ã™

# npm-deps ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ãˆï¼

ãã‚“ãªä¸­ã€ã“ã®è¨˜äº‹ã‚’ç™ºè¦‹ã€‚
https://clojurescript.org/news/2017-07-12-clojurescript-is-not-an-island-integrating-node-modules

ã»ã†ã»ã†ï¼
æ—©é€Ÿè©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```console
$ lein new figwheel-node hello-aws-cli
$ cd hello-aws-cli
```

project.clj ã« `:npm-deps {:aws-sdk "^2.167.0"}` ã¨ `:install true`ã‚’è¿½åŠ ã€‚

```diff
diff --git a/project.clj b/project.clj
index 24f0146..065a9f6 100644
--- a/project.clj
+++ b/project.clj
@@ -25,6 +25,8 @@
                 :output-to "target/js/compiled/hello_aws_cli.js"
                 :output-dir "target/js/compiled/dev"
                 :target :nodejs
+                :npm-deps {:aws-sdk "^2.167.0"}
+                :install-deps true
                 :optimizations :none
                 :source-map-timestamp true}}
              {:id "prod"
```

ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« + cljs ã‚³ãƒ¼ãƒ‰ â†’ JS ã‚³ãƒ¼ãƒ‰ã¸ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ« + REPL ã‚’é–‹ããŸã‚ã« `lein figwheel`ã‚’å®Ÿè¡Œã€‚

```console
$ lein figwheel
Launching ClojureScript REPL for build: dev
Figwheel Controls:
          (stop-autobuild)                ;; stops Figwheel autobuilder
          (start-autobuild [id ...])      ;; starts autobuilder focused on optional ids
          (switch-to-build id ...)        ;; switches autobuilder to different build
          (reset-autobuild)               ;; stops, cleans, and starts autobuilder
          (reload-config)                 ;; reloads build config and resets autobuild
          (build-once [id ...])           ;; builds source one time
          (clean-builds [id ..])          ;; deletes compiled cljs target files
          (print-config [id ...])         ;; prints out build configurations
          (fig-status)                    ;; displays current state of system
          (figwheel.client/set-autoload false)    ;; will turn autoloading off
          (figwheel.client/set-repl-pprint false) ;; will turn pretty printing off
  Switch REPL build focus:
          :cljs/quit                      ;; allows you to switch REPL to another build
    Docs: (doc function-name-here)
    Exit: Control+C or :cljs/quit
 Results: Stored in vars *1, *2, *3, *e holds last exception object
Prompt will show when Figwheel connects to your application
```

ã¨å‡ºã‚‹ã®ã§ã€åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ç«‹ã¡ä¸Šã’ã¦

```
$ node target/js/compiled/hello_aws_cli.js
Hello world!
Figwheel: Can't start Figwheel!! Please make sure ws is installed
 do -> 'npm install ws'
```

ã‚“ï¼Ÿï¼Ÿ
`lein figwheel` ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹ä¾å­˜é–¢ä¿‚ã¯ project.clj ã«è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã ã‘ï¼ˆpackage.json ã§ç®¡ç†ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã‚Œãªã„ï¼‰ã¿ãŸã„ã§ã™ã­ã€‚

ãã“ã§ã€è¨€ã‚ã‚Œã‚‹é€šã‚Š npm install ã‚’å®Ÿè¡Œã—ãŸã®ã¡ã€å†åº¦å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨...

```console
$ npm install
....

$ lein figwheel
Hello world!
Figwheel: trying to open cljs reload socket
Figwheel: socket connection established
```

ãŠã£ã€ã†ã¾ãã„ã£ã¦ãã†ã€‚
ã‚‚ã†ç‰‡æ–¹ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ã¿ã‚‹ã¨ã€

```console
...
Prompt will show when Figwheel connects to your application
To quit, type: :cljs/quit
dev:cljs.user=> (+ 1 2)
3
dev:cljs.user=>
```

ã„ã„æ„Ÿã˜ã§ã™ã­ï¼ã“ã‚Œã§ REPL ã®æº–å‚™ãŒã§ãã¾ã—ãŸã€‚
ãã‚Œã§ã¯ AWS SDK ã‚’èª­ã¿è¾¼ã‚ã‚‹ã‹è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

```console
dev:cljs.user=> (require '[cljs.nodejs :as nodejs])
nil
dev:cljs.user=> (def AWS (nodejs/require "aws-sdk"))
#'cljs.user/AWS
dev:cljs.user=> AWS
#js {:util #js {:environment "nodejs", :engine #object[engine], :userAgent #object[userAgent], :isBrowser #object[isBrowser], :isNode #object[isNode], :uriEscape #object[uriEscape], :uriEscapePath #object[uriEscapePath], :urlParse #object[urlParse], ... ; ä»¥ä¸‹ç•¥
```

ãŠã£ï¼ã‚„ã£ãŸã­ã€‚

:npm-deps ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã¨ã€é©šãã»ã©ç°¡å˜ã« npm ãŒä½¿ãˆã¦ã„ã„æ„Ÿã˜ã§ã™ã­ï¼[^3]

[^3]: ãŸã ã—ã€ClojureScript v1.9.518 ä»¥é™ ã§ã—ã‹ä½¿ãˆãªã„ã®ã§ãŠæ°—ã‚’ã¤ã‘ãã ã•ã„...

# å‚è€ƒ URL

https://cljs.github.io/api/compiler-options/npm-deps
https://anmonteiro.com/2017/03/requiring-node-js-modules-from-clojurescript-namespaces/
https://clojurescript.org/news/2017-07-12-clojurescript-is-not-an-island-integrating-node-modules
